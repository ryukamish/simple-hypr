#!/usr/bin/env bash

PIDFILE="/tmp/wl-screenrec.pid"
RECORDINGS_DIR="$HOME/Videos/recordings"

# Check if recordings directory exists, if not create it
if [ ! -d "$RECORDINGS_DIR" ]; then
    mkdir -p "$RECORDINGS_DIR"
fi

if [ -f "$PIDFILE" ]; then
    # Stop recording
    /usr/bin/kill $(cat "$PIDFILE") 2>/dev/null
    rm "$PIDFILE"
    /usr/bin/notify-send "Screen Recording" "Recording stopped"
else
    # Start recording
    GEOMETRY=$(/usr/bin/slurp 2>/dev/null)
    if [ $? -eq 0 ] && [ -n "$GEOMETRY" ]; then
        # Record selected area
        /usr/bin/wl-screenrec --audio -g "$GEOMETRY" -f "$RECORDINGS_DIR/recording-$(date +%Y%m%d-%H%M%S).mp4" &
        echo $! > "$PIDFILE"
        /usr/bin/notify-send "Screen Recording" "Recording selected area started"
    else
        # Record full screen (when slurp is cancelled or fails)
        /usr/bin/wl-screenrec --audio -f "$RECORDINGS_DIR/recording-$(date +%Y%m%d-%H%M%S).mp4" &
        echo $! > "$PIDFILE"
        /usr/bin/notify-send "Screen Recording" "Full screen recording started"
    fi
fi
